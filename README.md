# Tracking for HIVE
<div align="center">
<p>
<img src="trackers/strong_sort/results/output_th025.gif" width="400"/> 
</p>
<br>


</div>

## Content:
* [Introduction](#introduction)
* [Flow](#flow)
* [Requirements](#requirements)
* [Usage](#usage)
* [Running Options](#running-options)


## Introduction

This repository contains a highly configurable two-stage-tracker that is designed to run 
on Jetson edge computing devices (by NVIDIA). 
The detections generated by [YOLOv5](https://github.com/ultralytics/yolov5), a family of object detection architectures
and models pretrained on the COCO dataset, are passed to the tracker of your choice. 
Supported ones at the moment are: [StrongSORT](https://github.com/dyhBUPT/StrongSORT)[](https://arxiv.org/pdf/2202.13514.pdf)
[OSNet](https://github.com/KaiyangZhou/deep-person-reid)[](https://arxiv.org/abs/1905.00953),
[OCSORT](https://github.com/noahcao/OC_SORT)[](https://arxiv.org/pdf/2203.14360.pdf) and 
[ByteTrack](https://github.com/ifzhang/ByteTrack)[](https://arxiv.org/pdf/2110.06864.pdf).
They can track any object that your Yolov5 model was trained to detect.


## Flow

This repository gives the user the option to configure the source of the video stream. 
In addition, the user can choose in what way to save the analytics results, and where to save or stream them.
* Optional video sources: 
  * From local file
  * From RTP video stream
* Optional results destinations:
  * To local file
  * To given IP address 
* Optional results formats:
  * Raw detections data (JSON)
  * Video with detection results on it
  
Note that not all combinations are supported.

## Requirements
* Docker
* Jetpack v5.0.2 or v4.6.1(Support for another versions is not guranteed)

For v5.0.2 use the dev branch, for v4.6.1 move to [this branch](https://github.com/CV-Team50/DeepSortTracking/tree/ubuntu_18_jetpack_32_7_3) and follow the same procedure shown in [Usage](#usage).

## Usage 
The following instructions are for usage on Jetson products (Checked on Xavier AGX, Xavier NX)
1. Build the docker image with running [`build_docker.sh`](https://github.com/CV-Team50/DeepSortTracking/blob/dev/build_docker.sh)
2. Run the docker image using:
    ```shell
   docker run -it --network host --runtime nvidia full_tracker_image
   ```
3. On the container, run command according to your choice (more in [Running Options](#Running Options)).


## Running Options
Run:
```shell
python3 track.py --source {SOURCE}
```
Where SOURCE is a string that could be either a local path to a video file, or a Gstreamer pipeline for video streaming.

For saving the detections results locally (in video format), run:
```shell
python3 track.py --source {SOURCE} --save-vid
```

For streaming the detection results (both in JSON/video format) run:
```shell
python3 track.py --source {SOURCE} \
	--stream-tracking-results {MODE} \
	--stream-tracking-ip {DEST_IP} \
	--stream-tracking-port {DEST_PORT}
```
Where MODE is an integer could be:

 0 - no stream (default option)

 1 - streams frames with detections using GStreamer

 2 - sends only detections through a socket

DEST_IP, DEST_PORT are the IP address and port for streaming the data.

For example, using local video and sending the tracking results with video format to local host, run:
```shell
python3 track.py --source {PATH_TO_FILE} \
    --stream-tracking-results 1 \
    --stream-tracking-ip 127.0.0.1 \
    --stream-tracking-port 5004
```

For more information on additional flags run:
```shell
python3 track.py --help
```

